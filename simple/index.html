<!DOCTYPE html>
<html>
<head>
  <title>Simple WebComponent test page</title>
</head>
<body>
  <test-component background>
    <div slot="slot2">slot2-1</div>
    <div slot="slot2">slot2-2</div>
    <div slot="slot1" data-index="1">slot1-1</div>
    <div slot="slot1" data-index="2">slot1-2</div>
    <div>no-slot-defined</div>
  </test-component>

  <textarea readonly="readonly" style="width:80%; height: 800px; padding: 20px">
// 1. Make sure you have only one tab in your browser so that tabs[0].content is this
//    window
// 2. Run the code below in the browser content toolbox

(function (selector) {
  function getChildren(doc, node, showAnonymousContent = true) {
    const { classes: Cc, interfaces: Ci } = Components;

    let walker = Cc["@mozilla.org/inspector/deep-tree-walker;1"].createInstance(Ci.inIDeepTreeWalker);
    walker.showAnonymousContent = showAnonymousContent;
    walker.showSubDocuments = true;
    walker.showDocumentsAsNodes = true;
    // SHOW_ALL: 0xFFFFFFFF
    walker.init(doc, 0xFFFFFFFF);
    walker.currentNode = node

    walker.firstChild();

    let children = []
    do {
      // Skip text nodes
      if (walker.currentNode.nodeType != Ci.nsIDOMNode.TEXT_NODE) {
        children.push(walker.currentNode);
      }
      walker.nextSibling();
    } while(walker.currentNode.nextSibling);

    return children;
  }

  let doc = tabs[0].content.document;
  let testComponent = doc.querySelector(selector);

  return {
    shadowTree: getChildren(doc, testComponent, true),
    lightTree: getChildren(doc, testComponent, false),
  }
})("test-component");
  </textarea>

<script>
(function() {
  'use strict';

  // Feature detect
  if (!(window.customElements && document.body.attachShadow)) {
    document.querySelector('test-component').innerHTML =
      `<b>
         Not supported. In about:config, set "dom.webcomponents.shadowdom.enabled"
         to true.
       </b>`;
    return;
  }

  customElements.define('test-component', class extends HTMLElement {
    constructor() {
      super(); // always call super() first in the ctor.

      // Create shadow DOM for the component.
      let shadowRoot = this.attachShadow({mode: 'open'});
      shadowRoot.innerHTML = `
        <style>
        </style>
        <div id="slot1-container">
          <slot id="slot1" name="slot1"></slot>
        </div>
        <div id="slot2-container">
          <slot name="slot2"></slot>
        </div>
        <div id="footer">
          <slot></slot>
        </div>
      `;
    }

    connectedCallback() {
      console.log("connected");

      // Save refer to we can remove listeners later.
      this._onSlot1Click = this._onSlot1Click.bind(this);

      const slot1 = this.shadowRoot.querySelector('#slot1');
      slot1.addEventListener('click', this._onSlot1Click);
    }

    disconnectedCallback() {
      console.log("disconnected");
      const slot1 = this.shadowRoot.querySelector('[name="slot1"]');
      slot1.removeEventListener('click', this._onSlot1Click);
    }

    _onSlot1Click(e) {
      console.log("Clicked on " + e.target.dataset.index);
    }
  });

})();
</script>

</body>
</html>